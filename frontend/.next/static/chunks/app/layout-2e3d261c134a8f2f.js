(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1290:()=>{},6200:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1290,23)),Promise.resolve().then(r.bind(r,7246))},7246:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>d,A:()=>h});var a=r(5155),o=r(2115),s=r(5125),l=r(5704);let n=s.A.create({baseURL:l.env.NEXT_PUBLIC_API_URL||"http://localhost:3000",withCredentials:!0,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{accessToken:t}=(await s.A.post("".concat(l.env.NEXT_PUBLIC_API_URL||"http://localhost:3000","/auth/refresh"),{refreshToken:e},{withCredentials:!0})).data;return localStorage.setItem("accessToken",t),r.headers.Authorization="Bearer ".concat(t),n(r)}}catch(e){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/auth/login"}}return Promise.reject(e)});let c={async login(e){var t,r;let a=await n.post("/auth/login",e),o=a.data.accessToken||(null==(t=document.cookie.split("; ").find(e=>e.startsWith("accessToken=")))?void 0:t.split("=")[1]),s=a.data.refreshToken||(null==(r=document.cookie.split("; ").find(e=>e.startsWith("refreshToken=")))?void 0:r.split("=")[1]);return o&&localStorage.setItem("accessToken",o),s&&localStorage.setItem("refreshToken",s),{user:a.data.user,accessToken:o||"",refreshToken:s||""}},async register(e){var t,r;let a=await n.post("/users",e),o=a.data.accessToken||(null==(t=document.cookie.split("; ").find(e=>e.startsWith("accessToken=")))?void 0:t.split("=")[1]),s=a.data.refreshToken||(null==(r=document.cookie.split("; ").find(e=>e.startsWith("refreshToken=")))?void 0:r.split("=")[1]);return o&&localStorage.setItem("accessToken",o),s&&localStorage.setItem("refreshToken",s),{user:a.data.user,accessToken:o||"",refreshToken:s||""}},async logout(){try{await n.post("/auth/logout")}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}},getCurrentUser:async()=>(await n.get("/auth/me")).data,async refreshToken(){let e=localStorage.getItem("refreshToken");if(!e)throw Error("No refresh token available");let{accessToken:t}=(await n.post("/auth/refresh",{refreshToken:e})).data;return localStorage.setItem("accessToken",t),{accessToken:t}},isAuthenticated:()=>!!localStorage.getItem("accessToken"),getAccessToken:()=>localStorage.getItem("accessToken"),getRefreshToken:()=>localStorage.getItem("refreshToken")};var i=r(63);let u=(0,o.createContext)(void 0),h=()=>{let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{let{children:t}=e,[r,s]=(0,o.useState)(null),[l,n]=(0,o.useState)(!0),[h,d]=(0,o.useState)(null),g=(0,i.useRouter)();(0,o.useEffect)(()=>{(async()=>{try{if(c.isAuthenticated()){let e=await c.getCurrentUser();s(e)}}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}finally{n(!1)}})()},[]);let k=async e=>{try{n(!0),d(null);let t=await c.login(e);s(t.user),g.push("/dashboard")}catch(e){var t,r;throw d((null==(r=e.response)||null==(t=r.data)?void 0:t.message)||"Login failed. Please try again."),e}finally{n(!1)}},f=async e=>{try{n(!0),d(null);let t=await c.register(e);s(t.user),g.push("/dashboard")}catch(e){var t,r;throw d((null==(r=e.response)||null==(t=r.data)?void 0:t.message)||"Registration failed. Please try again."),e}finally{n(!1)}},m=async()=>{try{await c.logout()}catch(e){console.error("Logout error:",e)}finally{s(null),g.push("/auth/login")}};return(0,a.jsx)(u.Provider,{value:{user:r,isLoading:l,isAuthenticated:!!r,login:k,register:f,logout:m,error:h,clearError:()=>{d(null)}},children:t})}}},e=>{e.O(0,[741,977,441,255,358],()=>e(e.s=6200)),_N_E=e.O()}]);